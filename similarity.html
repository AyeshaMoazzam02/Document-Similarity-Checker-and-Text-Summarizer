<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Similarity</title>
    <link rel="stylesheet" href="/static/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.css"/>
</head>
<body>
    <!-- header section starts-->
    <section class="header">
        <nav class="navbar">
            <div class="navbar-brand">
                <a href="{{ url_for('Home') }}">DocuSolutions</a>
            </div>
            <div class="navbar-nav">
                <a href="{{ url_for('Home') }}">Home</a>
                <a href="{{ url_for('Summarization') }}">Summarization</a>
                <a href="{{ url_for('Similarity') }}">Similarity</a>
                <a href="{{ url_for('About') }}">About</a>
            </div>
            <div class="navbar-sign">
                <a href="{{ url_for('signIn') }}" class="signIn">Sign in</a>
                <a href="{{ url_for('signUp') }}" class="signup">Sign Up</a>
            </div>
        </nav>
        <div id="menu-btn" class="fas fa-bars"></div>
    </section>

    <!-- Header section ends-->

    <div id="container">
        <div id="sidebar">
            <!-- Sidebar content here -->
            <a href="{{ url_for('Summarization') }}" class="button">Summarize Text</a>
            <a href="{{ url_for('Similarity') }}" class="button">Check Similarity</a>
            <a href="{{ url_for('PP') }}" class="button">Privacy Policy</a>
            <a href="{{ url_for('Home') }}" class="button">FAQ's</a>
        </div>

        <div id="mainContent">
            <h1>Document Similarity Checker</h1>
            <div class="flex-container">
                <div class="input-section">
                    <h2>Input Files</h2>
                    <p>Insert more than one files for document similarity checking</p>
                    <div class="upload-area">
                        <p>Browse pdf, docx, txt, files here</p>
                        <!-- This is the input field that will trigger the file dialog -->
                        <input type="file" id="file-input" name="file[]" multiple style="display: none;"/>

                        <!-- This is a label that is styled like a button, which links to the input field -->
                        <label for="file-input" class="file-upload-button">Upload Files</label>
                        <br>
                        <div id="file-info"></div>
                    </div>
                </div>
                <div class="output-section">
                    <h2>Report</h2>
                    <div id="loading" style="display:none;">
                        <i class="fa fa-spinner fa-spin"></i> Loading...
                    </div>
                    <!-- The content will be dynamically inserted here -->
                    <div id="output-content">
                        <!-- Content will be generated by JavaScript -->
                    </div>
                    <button id="downloadReport" style="display: none;"><i class="fa-solid fa-download"></i>Download Report</button>
                </div>
            </div>
            <button id="checkNow">Check Now</button>
        </div>
    </div>
           
    <div id="box-container">
        <h3>How to Find Similarity Between Documents Using this Tool?</h3><br>
        <div id="grid-container">

            <div class="box">
                <div class="image">
                    <i class="fa-solid fa-upload"></i>
                </div>
                <div class="content">
                    <h3>Click on the upload button. The system opens a dialog box for file selection, where you can choose more than one documents of pdf, text or docx format to upload.  </h3>
                </div>
            </div>
    
            <div class="box">
                <div class="image">
                    <i class="fa-solid fa-file-pdf"></i>
                </div>
                <div class="content">
                    <h3>You can also upload scanned images of text but they should be in pdf format.  </h3>
                </div>
            </div>

            <div class="box">
                <div class="image">
                    <i class="fa-solid fa-file-import"></i>
                </div>
                <div class="content">
                    <h3>Select and import the documents that you want to check the similarity . </h3>
                </div>
            </div>
        
            <div class="box">
                <div class="image">
                    <i class="fa-solid fa-arrow-pointer"></i>
                </div>
                <div class="content">
                    <h3>Once the documents are uploaded, click the check now button. </h3>
                </div>
            </div>
            
            <div class="box">
                <div class="image">
                    <i class="fa-solid fa-list"></i>
                </div>
                <div class="content">
                    <h3>The application processes the uploaded document for simialrity Checking and you will get your report in seconds!</h3>
                </div>
            </div>

            <div class="box">
                <div class="image">
                    <i class="fa-solid fa-download"></i>
                </div>
                <div class="content">
                    <h3>You can download the generated report by clicking on the download report button.</h3>
                </div>
            </div>
        </div>
    </div>

    <div id="box-container">
        <h3>What can you do with this Similarity Checking Tool?</h3><br>
        <div class="section-content">
        <ul>
            <li>This document compare tool is designed to accommodate multiple text file types</li>
            <li>Using artificial intelligence in our application, we use machine learning for checking similarities between two documents. The AI technology helps in finding rephrased sentences between two texts during compare checks.</li>
            <li>You can download the comparison report as PDF.</li>
        </ul>
        <div class="image-container">
            <img src="https://sitechecker.pro/wp-content/uploads/2020/01/photo_2020-01-30_15-57-02.jpg" />
        </div>
        </div>
    </div>
<!-- Footer Section starts-->
<section class="footer">
    <div class="box-container">
        <div class="box">
            <h3>Quick Links</h3>
            <a href="{{ url_for('Home') }}"><i class="fas fa-angle-right"></i>Home</a>
            <a href="{{ url_for('Summarization') }}"><i class="fas fa-angle-right"></i>Summarization</a>
            <a href="{{ url_for('Similarity') }}"><i class="fas fa-angle-right"></i>Similarity</a>
            <a href="{{ url_for('About') }}"><i class="fas fa-angle-right"></i>About</a>
        </div>

        <div class="box">
            <h3>Extra Links</h3>
            <a href="{{url_for('About')}}"><i class="fas fa-angle-right"></i>Ask Questions</a>
            <a href="{{ url_for('About') }}"><i class="fas fa-angle-right"></i>About us</a>
            <a href="{{ url_for('PP') }}"><i class="fas fa-angle-right"></i>Privacy Policy</a>
            <a href="{{ url_for('PP') }}"><i class="fas fa-angle-right"></i>Terms of use</a>
        </div>

        <div class="box">
            <h3>Contact Info</h3>
            <a href="#"><i class="fas fa-envelope"></i>zaf7602@gmail.com</a>
            <a href="https://www.linkedin.com/in/ayesha-moazzam-256a54244/"><i class="fa-brands fa-linkedin"></i> LinkedIn</a>
            <a href="https://github.com/AyeshaMoazzam02"><i class="fa-brands fa-github"></i>Github</a>
            <a href="#"><i class="fas fa-map"></i>Islamabad, Pakistan, 45710</a>
        </div>
    </div>
    <div class="credit">created by <span> 20-SE-32, 36, 78</span> | all rights reserved!</div>
</section>

<!-- Footer Section ends-->

<script>
    function openInNewTab(src) {
    var newTab = window.open();
    newTab.document.write(`<img src="${src}" style="max-width:100%;height:auto;">`); 
    newTab.document.close(); // Ensures the tab is ready after image load
}

 document.addEventListener('DOMContentLoaded', function() {
    const checkNowButton = document.getElementById('checkNow');
    const fileInput = document.getElementById('file-input');
    const fileInfoDisplay = document.getElementById('file-info');
    const outputContent = document.getElementById('output-content');
    const downloadReportButton = document.getElementById('downloadReport');
    const formData = new FormData();

    fileInput.addEventListener('change', function() {
        const files = Array.from(this.files);
        let allFilesValid = true;
        files.forEach(file => {
            const fileExtension = file.name.split('.').pop().toLowerCase();
            if (!['pdf', 'txt', 'docx'].includes(fileExtension)) {
                allFilesFix = false;
                fileInfoDisplay.innerHTML += `<p style="color: red;">Invalid file format: ${file.name}</p>`;
            } else {
                fileInfoDisplay.innerHTML += Array.from(this.files).map(file => `<p>${file.name} successfully uploaded.</p>`).join('');
                formData.append('file[]', file); // Add valid files to FormData
            }
        });
        if (!allFilesValid) {
            alert('Some files have invalid formats. Only PDF, TXT, and DOCX files are allowed.');
        }
    });

    checkNowButton.addEventListener('click', function() {
        if (fileInput.files.length === 0) {
            alert('Please select files to check.');
            return;
        }
        document.getElementById('loading').style.display = 'block';
            outputContent.textContent = '';

        fetch('/upload-files', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            document.getElementById('loading').style.display = 'none';
            const similarityListItems = data.similarity_percentage.map(item => `<li>Similarity between
        ${item['Document 1']} and ${item['Document 2']}: ${item['Similarity']}</li>
            `).join('');
            outputContent.innerHTML = `
                <h3>Percentage Based Scores</h3>
                <ul style="font-size: 15px; padding-top: 32px; padding-left: 20px;" id="similarity_percentages">
                    ${similarityListItems}
                </ul>
                <h3>Cosine Similarity Heatmap</h3>
                <img src="${data.heatmap_image}" alt="Cosine Similarity Heatmap" id="heatmap" onclick="openInNewTab('${data.heatmap_image}')" style="cursor:pointer;">
                <h3>Histogram of Document Similarity Scores</h3>
                <img src="${data.histogram_image}" alt="Histogram of Document Similarity Scores" id="histogram" onclick="openInNewTab('${data.histogram_image}')" style="cursor:pointer;">
                <h3>Similarity Index</h3>
                <p id="similarity_index" style="padding: 25px;">The mean similarity index is: ${data.similarity_index}</p>
            `;
            downloadReportButton.style.display = 'block';
            downloadReportButton.href = data.report_path;
        }).catch(error => {
            console.error('Error:', error);
            document.getElementById('loading'). style.display = 'none';
            alert('Failed to process the files. Please try again.');
        });
    });

    downloadReportButton.addEventListener('click', function() {
    try {
        const data = {
            heatmap_html: document.getElementById('heatmap').outerHTML,
            histogram_html: document.getElementById('histogram').outerHTML,
            similarity_index: document.getElementById('similarity_index').textContent,
            similarity_percentages: document.getElementById('similarity_percentages').textContent
        };

        fetch('/download-report', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        })
        .then(response => response.blob())
        .then(blob => {
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.style.display = 'none';
            a.href = url;
            a.download = 'report.pdf';
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
        })
        .catch(error => console.error('Error downloading the report:', error));
    } catch (error) {
        console.error('Failed to parse similarity percentages:', error);
        alert('Failed to process the download. Please check the data format.');
    }
});
});
</script>  
</body>
</html>

